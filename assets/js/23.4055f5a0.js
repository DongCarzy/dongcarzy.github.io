(window.webpackJsonp=window.webpackJsonp||[]).push([[23],{413:function(s,a,e){"use strict";e.r(a);var t=e(5),n=Object(t.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"编译安装redis"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#编译安装redis"}},[s._v("#")]),s._v(" 编译安装Redis")]),s._v(" "),a("blockquote",[a("p",[s._v("ubuntu 22.04.3")])]),s._v(" "),a("h3",{attrs:{id:"_1-下载redis源码包"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-下载redis源码包"}},[s._v("#")]),s._v(" 1. 下载redis源码包")]),s._v(" "),a("p",[a("a",{attrs:{href:"https://redis.io/",target:"_blank",rel:"noopener noreferrer"}},[s._v("redis官网"),a("OutboundLink")],1)]),s._v(" "),a("p",[s._v("下载最新的稳定版本。 （7.2）")]),s._v(" "),a("h3",{attrs:{id:"_2-编译安装"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-编译安装"}},[s._v("#")]),s._v(" 2.编译安装")]),s._v(" "),a("p",[s._v("将 "),a("code",[s._v("redis.tar.gz")]),s._v("解压到 linxu下的 "),a("code",[s._v("/usr/local/src")]),s._v(" 下，用"),a("code",[s._v("make")]),s._v("命令编译。需要一下依赖")]),s._v(" "),a("ul",[a("li",[s._v("pkg-config")]),s._v(" "),a("li",[s._v("gcc")])]),s._v(" "),a("p",[s._v("如果报错缺失 "),a("code",[s._v("cc")]),s._v(" 和 "),a("code",[s._v("pkg-config")]),s._v("， 则需要安装对应的依赖")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt-get")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" pkg-config\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt-get")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" gcc\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("将redis安装到指定的目录下：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("make")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("PREFIX")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/opt/redis "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("此时会在 "),a("code",[s._v("/opt/redis/bin")]),s._v(" 下生成相关的启动程序")]),s._v(" "),a("ul",[a("li",[s._v("redis-server  服务")]),s._v(" "),a("li",[s._v("redis-cli 客户端")]),s._v(" "),a("li",[s._v("redis-benchmark 性能测试工具")]),s._v(" "),a("li",[s._v("redis-check-aof")]),s._v(" "),a("li",[s._v("redis-check-rdb")])]),s._v(" "),a("p",[s._v("复制一份 "),a("code",[s._v("redis.conf")]),s._v("文件到 "),a("code",[s._v("/opt/redis/conf")]),s._v("下")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" /opt/redis/conf\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" /usr/local/src/redis.conf /opt/redis/conf\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("h3",{attrs:{id:"_3-启动程序"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-启动程序"}},[s._v("#")]),s._v(" 3.启动程序")]),s._v(" "),a("p",[s._v("前台启动")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("./redis-server "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("/conf/redis.conf \n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("后台启动")]),s._v(" "),a("p",[s._v("方式一：nohup")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("nohup")]),s._v(" redis-server "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("方式二： 配置后台启动")]),s._v(" "),a("p",[s._v("修改 "),a("code",[s._v("redis.conf")]),s._v("配置文件 中的 "),a("code",[s._v("daemonize")]),s._v("属性值改为 "),a("code",[s._v("yes")]),s._v("即可")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("./redis-server "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("/conf/redis.conf\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h3",{attrs:{id:"_4-注册service服务"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-注册service服务"}},[s._v("#")]),s._v(" 4. 注册service服务")]),s._v(" "),a("p",[s._v("将 "),a("code",[s._v("redis")]),s._v("注册为"),a("code",[s._v("linxu")]),s._v("服务，可开机启动")]),s._v(" "),a("p",[s._v("在我们的源码文件夹 "),a("code",[s._v("/usr/local/src/redis/utils")]),s._v("下有对应的工具包。 通过脚本 "),a("code",[s._v("install_server.sh")]),s._v("来注册服务。是交互式的，通过端口来区分实例，不过在新版linxu服务器上，建议使用 "),a("code",[s._v("systemd")]),s._v(" 来管理服务，所以redis上会提示:")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("Welcome to the redis "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" installer\nThis script will "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("help")]),s._v(" you easily "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" up a running redis server\n\nThis systems seems to use systemd.\nPlease take a "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("look")]),s._v(" at the provided example "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" unit files "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" this directory, and adapt and "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" them. Sorry"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("p",[s._v("可以通过修改安装的脚本来跳过校验, 注释下面的校验行就行了")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#bail if this system is managed by systemd")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("_pid_1_exe")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),s._v("readlink "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-f")]),s._v(" /proc/1/exe"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v('"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${_pid_1_exe"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("##")]),s._v("*"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("}")]),s._v('"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" systemd "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("then")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"This systems seems to use systemd."')]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Please take a look at the provided example service unit files in this directory, and adapt and install them. Sorry!"')]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exit")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("fi")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("unset")]),s._v(" _pid_1_exe\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])]),a("p",[s._v("不过不建议采用以上的方案， 应遵循新的linux管理方式， 采用  "),a("code",[s._v("systemd")])]),s._v(" "),a("h3",{attrs:{id:"_5-注册为systemd服务"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-注册为systemd服务"}},[s._v("#")]),s._v(" 5. 注册为systemd服务")]),s._v(" "),a("p",[s._v("将 "),a("code",[s._v("systemd-redis_server.service")]),s._v("  文件拷贝到 "),a("code",[s._v("/etc/systemd/system")]),s._v(" 下")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" systemd-redis_server.service /etc/systemd/system/redis_server.service\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("根据自己需求定制化。 如下：")]),s._v(" "),a("div",{staticClass:"language-properties line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-properties"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 修改redis.conf")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 改为后台启动")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("daemoninze")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("yes")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# pid文件存放位置")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("pidfile")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("/opt/redis/redis_6379.pid")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 日志存放位置")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("logfile")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("/opt/redis/redis.log")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# redis数据存放位置")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("dir")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("/opt/redis")]),s._v("\n\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#  修改 redis_server.service 文件的启动文件")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 启动")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("ExecStart")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("/opt/redis/bin/redis-server /opt/redis/conf/redis.conf")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 停止")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("ExecStop")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("/opt/redis/bin/redis-cli shutdown")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 因为上面redis的配置 daemon 是 yes， 所以这里必须采用 forking")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("Type")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("forking")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br")])])])}),[],!1,null,null,null);a.default=n.exports}}]);